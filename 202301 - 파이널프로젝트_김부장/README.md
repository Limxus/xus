# [KH íŒŒì´ë„ í”„ë¡œì íŠ¸] ê·¸ë£¹ì›¨ì–´ - ê¹€ë¶€ì¥, íšŒì‚¬ë¥¼ ë°”ê¾¸ë‹¤

ê¸°ê°„: 2022ë…„ 11ì›” 14ì¼ â†’ 2023ë…„ 1ì›” 13ì¼
ì‚¬ìš©í•œ ê¸°ìˆ : JAVA, HTML, css, JavaScript, ajax, mybatis, Spring, websocket, MailSender
í•œì¤„ì†Œê°œ: ê·¸ë£¹ì›¨ì–´

## ğŸˆâ€â¬› git

[https://github.com/Woooooon/sixman](https://github.com/Woooooon/sixman)

![Untitled](%5BKH%20%E1%84%91%E1%85%A1%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%5D%20%E1%84%80%E1%85%B3%E1%84%85%E1%85%AE%E1%86%B8%E1%84%8B%E1%85%B0%E1%84%8B%E1%85%A5%20-%20%E1%84%80%E1%85%B5%E1%86%B7%E1%84%87%E1%85%AE%E1%84%8C%E1%85%A1%E1%86%BC,%20%E1%84%92%E1%85%AC%E1%84%89%E1%85%A1%E1%84%85%209ddf0550846d4bcf894f23d9186708da/Untitled.png)

<aside>
ğŸ‘‰ Spring í”„ë ˆì„ì›Œí¬ì™€ mybatisì˜ ì‚¬ìš©ì„ í†µí•´ webappì„ ì œì‘í•  ìˆ˜ ìˆë‹¤
ë˜í•œ Springì˜ MVC ëª¨ë¸ì„ ì´í•´í•œë‹¤

</aside>

## ğŸ‘¨â€ğŸ’» ë‚´ êµ¬í˜„ê¸°ëŠ¥

- ê³µì§€ì‚¬í•­
    - ê³µì§€ì‚¬í•­ ë“±ë¡
    - ê³µì§€ì‚¬í•­ ìˆ˜ì •
    - ê³µì§€ì‚¬í•­ ì¤‘ìš”ë„ ìƒë‹¨ê³ ì •
    - ê³µì§€ì‚¬í•­ ë°°ë„ˆ
- ë©”ì‹ ì €
    - ì‚¬ì›ëª©ë¡ í™•ì¸
    - ì‚¬ì› ì¦ê²¨ì°¾ê¸°
    - í”„ë¡œí•„í™•ì¸
    - ì±„íŒ…ë°© ìƒì„± 1:1, ë‹¤ìˆ˜
    - ì±„íŒ…ë°© ê²€ìƒ‰
    - ì±„íŒ…ë°© ìƒë‹¨ê³ ì •
    - ì±„íŒ…ë°© ì•ŒëŒ ì„¤ì •
    - íŒŒì¼ ë³´ê´€í•¨
    - íŒŒì¼ ì „ì†¡
    - ë©”ì„¸ì§€ ì½ì€ ì‚¬ëŒ í™•ì¸
- ì•ŒëŒ
    - ì‹¤ì‹œê°„ ì•ŒëŒ
- ë©”ì¼
    - ë©”ì¼ ì‘ì„±
    - ë©”ì¼ íŒŒì¼ ì²¨ë¶€
    - ì¹´í…Œê³ ë¦¬ ë“±ë¡
    - ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜
    - ë©”ì¼ ì‚­ì œ
    - ë©”ì¼ ìˆ˜ì •
    - ë©”ì¼ íœ´ì§€í†µ ë¹„ìš°ê¸°
    - gmail SMTP ë“±ë¡
- ì „ìê²°ì¬
    - ê²°ì¬ì„  ë“±ë¡
    - ê²°ì¬ì„  ì§€ì •
    - ì „ìë¬¸ì„œ ì‘ì„±
    - ê²°ì¬ ì²˜ë¦¬
    - ë°˜ë ¤ ì²˜ë¦¬

ğŸ’­ ì†Œê° 

mybatisë¥¼ í†µí•œ ë™ì ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê³  pl/sql, merge, insertAll ë“± ë‹¤ì–‘í•œ sqlë¬¸ì„ ì‚¬ìš©í•´ ë³´ì•˜ë‹¤.

ë˜í•œ Springì—ì„œì˜ ë””íœë˜ì‹œì™€ ë¹ˆë“±ë¡ì—ëŒ€í•´ì„œ ì¡°ê¸ˆ ë” ì´í•´í•˜ê³ 
ì›¹ì†Œì¼“ì„ í†µí•œ ì‹¤ì‹œê°„ ë°ì´í„°ì „ì†¡ì„ í•´ë³¼ ìˆ˜ ìˆì—ˆë‹¤.

## ğŸ’¬ ì½”ë“œë¦¬ë·°

```jsx
const searchInput = document.querySelector('#search-box input');

// ê²€ìƒ‰í•˜ëŠ” ì¸í’‹ë°•ìŠ¤ì— ì—”í„°í‚¤(keyCode == 13)ë¥¼ ëˆ„ë¥´ë©´ seach í•¨ìˆ˜ê°€ ë™ì‘í•˜ê²Œí•˜ê³  í˜„ì¬ onchangeë¥¼ ì´ˆê¸°í™”
function setSearch() {
    searchInput.onkeyup = (e)=>{
        if(e.keyCode != 13){
            return;
        }
        search();
    };
    searchInput.onchange = null;
}

// ë‚´ê°€ì›í•˜ëŠ” ìš”ì†Œë¥¼ ì„ íƒí•˜ëŠ” í•¨ìˆ˜
function selectRange(obj) {
    if (window.getSelection) {
        var selected = window.getSelection();
            selected.selectAllChildren(obj);
    } else if (document.body.createTextRange) {
        var range = document.body.createTextRange();
            range.moveToElementText(obj);
            range.select();
    }
}

function search() {
    if(searchInput.value==null||searchInput.value==''){
        return;
    }

    const msgs = document.querySelectorAll('.chat-msg');
    const findMsgs = [];

		// ë‚˜ì™€ìˆëŠ” ëª¨ë“  ë©”ì„¸ì§€ ì¤‘ ê²€ìƒ‰ê°’ê³¼ ì¼ì¹˜í•˜ë©´ findMsgs ë°°ì—´ì— ë‹´ì•„ì¤€ë‹¤
    for (let index = msgs.length-1; index >= 0; index--) {
        const element = msgs[index];
        const text = element.innerText;

        if(text.includes(searchInput.value)){
            findMsgs.push(element);
        }
    }

    if(findMsgs.length==0){
        return;
    }

		// ê°€ì¥ì²«ë²ˆì§¸ ì¼ì¹˜í•˜ëŠ” ë‚´ìš©ì„ ì„ íƒí•˜ê³  í™”ë©´ì„ í•´ë‹¹ ìš”ì†Œê°€ ìˆëŠ”ê³³ìœ¼ë¡œ ìŠ¤í¬ë¡¤ì‹œì¼œì¤€ë‹¤
    const firstElement = findMsgs[0];
    selectRange(firstElement);
    chatMain.scrollTop = firstElement.offsetTop - 400;

		// ì´í›„ ë™ì¼í•œ ìƒíƒœì—ì„œ ì—”í„°í‚¤ë¥¼ ëˆ„ë¥´ê²Œë˜ë©´ ë‹¤ìŒìš”ì†Œë¥¼ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤.
    let i = 1;
    searchInput.onkeyup = (e)=>{
        if(e.keyCode != 13) return;
        if(i >= findMsgs.length) return;

        const nextElement = findMsgs[i];
        selectRange(nextElement);
        chatMain.scrollTop = nextElement.offsetTop - 400;

        i++;
    };

		// í˜¹ì‹œ ì¸í’‹ë°•ìŠ¤ì— ë‹¤ë¥¸ ë²¨ë¥˜ê°€ ë“¤ì–´ê°€ê²Œ ëœë‹¤ë©´ onkeyup ì´ë²¤íŠ¸ë¥¼ ì´ˆê¸°í™”ì‹œì¼œì£¼ëŠ” setSearchë¥¼ ì‹¤í–‰í•œë‹¤.
    searchInput.onchange = ()=>{
        setSearch();
    }
}
```

ì±„íŒ…ë°© ëŒ€í™”ë‚´ìš© ê²€ìƒ‰ê¸°ëŠ¥

ì‹¤ì œ ì¹´ì¹´ì˜¤í†¡ë“± ë‹¤ì–‘í•œ ë©”ì‹ ì €ì²˜ëŸ¼ ëŒ€í™”ë‚´ìš©ì„ ê²€ìƒ‰í•˜ê³  í•´ë‹¹ ë‚´ìš©ì„ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ì‹¶ì—ˆë‹¤. ëª¨ë“  ëŒ€í™”ë‚´ìš©ì„ ë¶ˆëŸ¬ì™€ì„œ ì°¾ëŠ” ê°’ì´ ìˆëŠ”ì§€ íŒë‹¨í•˜ê³  ì„ íƒì²˜ë¦¬ ë° í™”ë©´ì´ë™ì„ ì‹œì¼œì£¼ì—ˆê³ 

ì´í›„ ì—”í„°ë¥¼ ë§¤ë²ˆì¹ ë•Œë§ˆë‹¤ ë‹¤ìŒ ë‚´ìš©ì„ ì°¾ì•˜ìœ¼ë©´ ì¢‹ê² ì–´ì„œ keyup ì´ë²¤íŠ¸ë¥¼ ì£¼ì—ˆë‹¤ ëŒ€ì‹  ì‚¬ìš©ìê°€ ë‹¤ë¥¸ê°’ì„ ì…ë ¥í•œí›„ ì—”í„°ë¥¼ ì³¤ì„ë•ŒëŠ” ìƒˆë¡œìš´ ê²€ìƒ‰ì´ ì´ë£¨ì–´ì ¸ì•¼í•´ì„œ change ì´ë²¤íŠ¸ë¡œ keyup ì´ë²¤íŠ¸ë¥¼ ì´ˆê¸°í™”ì‹œì¼œì£¼ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤.

```java
package com.kh.sixman.chat.handler;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.socket.CloseStatus;
import org.springframework.web.socket.TextMessage;
import org.springframework.web.socket.WebSocketSession;
import org.springframework.web.socket.handler.TextWebSocketHandler;

import com.kh.sixman.chat.service.ChatService;
import com.kh.sixman.chat.vo.ChatRoomVo;
import com.kh.sixman.member.vo.MemberVo;

import lombok.extern.slf4j.Slf4j;

@Slf4j
public class ChatHandler extends TextWebSocketHandler{

	// í˜„ì¬ ì ‘ì†í•œ ì‚¬ëŒë“¤ì„ íšŒì›ë²ˆí˜¸ì™€ WebSocketSessionìœ¼ë¡œ ì €ì¥
	private Map<String, WebSocketSession> userSessionsMap = new HashMap<String, WebSocketSession>();
	
	// HttpSessionHandshakeInterceptorë¥¼ ì´ìš©í•˜ì—¬ HttpSessionì˜ ì •ë³´ë¥¼ Mapìœ¼ë¡œ ë¦¬í„´í•˜ëŠ” ë©”ì„œë“œ
	private Map<String, Object> getHTTPSession(WebSocketSession session) {
		Map<String, Object> httpSession = session.getAttributes();
		return httpSession;
	}
	
	@Override
	public void afterConnectionEstablished(WebSocketSession session) throws Exception {
		Map<String, Object> httpSession = getHTTPSession(session);
		MemberVo curMember = (MemberVo)httpSession.get("loginMember");
		if(curMember==null) return; 
				
		log.info("Chat Socket ì—°ê²°");
		log.info("id : " + session.getId());

		userSessionsMap.put(curMember.getNo(), session);		

		// ëˆ„êµ°ê°€ ì ‘ì†í–ˆì„ ì‹œ ê°™ì€ ì±„íŒ…ë°©ì— ìˆëŠ” ì‚¬ëŒë“¤ì—ê²Œ ë°©ê¸ˆ ì ‘ì†í•œì‚¬ëŒì˜ ë§ˆì§€ë§‰ ì ‘ì†ì‹œê°„ì„ ì „ë‹¬		
		ChatRoomVo curRoom = (ChatRoomVo) httpSession.get("room");
		
		Set<String> keySet = userSessionsMap.keySet();
		for(String key : keySet) {
			
			if(key.equals(curMember.getNo())) continue;
			
			WebSocketSession memberWS = userSessionsMap.get(key);
			Map<String, Object> memberHS = getHTTPSession(memberWS);
			
			// ì±„íŒ…ë°© ì ‘ì†ì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ìª½ì—ì„œ ì ‘ì†í•œ ì±„íŒ…ë°©ì˜ ì •ë³´ë¥¼ sessionì— ë‹´ì•„ì£¼ê³ ìˆë‹¤.
			ChatRoomVo roomVo = (ChatRoomVo) memberHS.get("room");
			if(roomVo==null) continue;
			
			String room = roomVo.getChatRoomNo();
			
			if(room.equals(curRoom.getChatRoomNo())) {
				memberWS.sendMessage(new TextMessage("#####"+curRoom.getBeforeJoin()));
			}
		}
	}
	
	@Override
	public void afterConnectionClosed(WebSocketSession session, CloseStatus status) throws Exception {
		Map<String, Object> httpSession = getHTTPSession(session);
		MemberVo curMember = (MemberVo)httpSession.get("loginMember");
		
		log.info("Chat Socket ì¢…ë£Œ");
		log.info("id : " + session.getId());
		
		if(curMember!=null) {
			userSessionsMap.remove(curMember.getNo());			
		}
	}
	
	@Override
	protected void handleTextMessage(WebSocketSession session, TextMessage message) throws Exception {
		log.info("chat {}ë¡œë¶€í„° ë°›ì€ ë©”ì„¸ì§€ {}", session.getId(), message.getPayload());
		
		Map<String, Object> httpSession = getHTTPSession(session);
		ChatRoomVo curRoom = (ChatRoomVo)httpSession.get("room"); //ë³´ë‚¸ì‚¬ëŒ ì±„íŒ…ë°©ì •ë³´
		List<MemberVo> members = curRoom.getMembers(); //ë³´ë‚¸ì‚¬ëŒ ì±„íŒ…ë°©ì˜ ë§´ë²„ë“¤
		
		// ë©”ì„¸ì§€ í˜•íƒœ "ë³´ë‚¸ì‚¬ëŒë²ˆí˜¸#ë³´ë‚¸ì‚¬ëŒì´ë¦„#ë°©ë²ˆí˜¸#ë©”ì„¸ì§€#ë‚ ì§œ"
		String msg = message.getPayload();
		String msgs[] = msg.split("#");
		
		String roomNo = msgs[2];	
		
		// ë‚˜ë¥¼ì œì™¸í•œ ì±„íŒ…ë°© ì¸ì› ì¤‘ ì ‘ì†ì¤‘ì¸ ì‚¬ëŒì„ ìœ„í•´ ë¯¸ë¦¬ -1 í•˜ì˜€ë‹¤.
		int inMemberCount = -1;
		
		//í˜„ì¬ ì ‘ì†í•´ìˆëŠ” ì‚¬ëŒë“¤ ì¤‘ ë‚˜ë¥¼ í¬í•¨í•œ ê°™ì€ ì±„íŒ…ë°©ì— ì ‘ì†í•œ ì‚¬ëŒì„ ë‹´ì„ ë¦¬ìŠ¤íŠ¸
		List<WebSocketSession> sessions = new ArrayList<>();
		
		Set<String> keySet = userSessionsMap.keySet();
		for(String key : keySet) {
			WebSocketSession memberWS = userSessionsMap.get(key);
			Map<String, Object> memberHS = getHTTPSession(memberWS);
			
			ChatRoomVo roomVo = (ChatRoomVo) memberHS.get("room"); //ë‹¤ë¥¸ì‚¬ëŒ ì ‘ì†í•œ ë£¸ ì •ë³´
			String room = roomVo.getChatRoomNo();
			
			if(room.equals(roomNo)) {
				inMemberCount++;
				sessions.add(memberWS);
			}
		}
		
		// ë©”ì„¸ì§€ ëì— ì´ì¸ì› ì¤‘ ì ‘ì†í•˜ì§€ì•Šì€ì‚¬ëŒì„ ì¶”ê°€ë¡œ ë³´ë‚´ì¤€ë‹¤. ì´í›„ ì±„íŒ…ì˜† ì½ì€ì§€ì•Šì€ì‚¬ëŒ ìˆ«ìë¥¼ í‘œê¸°í• ë•Œ ì‚¬ìš©
		TextMessage text = new TextMessage(msg+"#"+(members.size()-inMemberCount));
		
		//ë”°ë¡œ ì¶”ê°€ëœ listì—ì„œë§Œ ë°˜ë³µë¬¸ì„ ì‚¬ìš©
		for(WebSocketSession ss : sessions) {
			ss.sendMessage(text);			
		}
	}

}
```

ì‹¤ì‹œê°„ ì±„íŒ…ì„ìœ„í•œ ì›¹ì†Œì¼“ ì‚¬ìš© ì½”ë“œ

ëˆ„êµ°ê°€ê°€ ì ‘ì†í•˜ë©´ ì ‘ì†í•œì‚¬ëŒë“¤ì„ mapì— ë‹´ì•„ì£¼ê³ 

ë™ì‹œì— ê°™ì€ ì±„íŒ…ë°©ì— ì ‘ì†í•´ìˆëŠ”ì‚¬ëŒë“¤ì˜ ì±„íŒ…ë°©ì—ì„œ ì½ìŒí‘œì‹œ (ì±„íŒ… ì˜† ìˆ«ì) ê°€ ì¤„ì–´ë“¤ì–´ì•¼ í•˜ê¸°ë•Œë¬¸ì— í•´ë‹¹ ì¸ì›ì˜ ì´ì „ ì ‘ì†ì‹œê°„ì„ ì „ë‹¬í•œë‹¤. 

ì´í›„ js ìª½ì—ì„ 

```jsx
//ì „ë‹¬ë°›ì€ ì ‘ì†ì‹œê°„ == date
function chatCountDown(date) {
				// ëª¨ë“  ì±„íŒ… ì¹´ìš´íŠ¸ (ì±„íŒ… ì˜† ìˆ«ì)ì—ëŠ” dateë¼ëŠ” ì†ì„±ì„ ì¶”ê°€í•´ ì£¼ì—ˆë‹¤ ì•ˆì—ëŠ” í•´ë‹¹ ë©”ì„¸ì§€ê°€ ì „ë‹¬ëœ ë‚ ì§œê°€ ì €ì¥ë˜ì–´ìˆë‹¤.
        const counts = document.querySelectorAll('.chat-count');
        const beforeDate = new Date(date);
        counts.forEach(element => {
            const eDate = new Date(element.getAttribute("date"));

            if(eDate > beforeDate){
                if(parseInt(element.innerHTML) - 1 > 0){
                element.innerHTML = parseInt(element.innerHTML) - 1;
                }else{
                    element.innerHTML = '';
                }
            }
        });
    }
```

---

```xml
<!-- fileMapper ì¤‘  -->
<update id="insertAll">
		INSERT ALL
		<foreach collection="list" item="vo" separator=" ">
			INTO ${tableName}_A
		(
			"NO",
			"ORIGIN_NAME",
			"${tableName}_NO",
			"CHANGE_NAME",
			"FILE_PATH",
			"ENROLL_DATE"
		)
		VALUES
		(
			get_seq_no('seq_${tableName}_no'),
			#{vo.originName},
			${vo.subNo},
			#{vo.changeName},
			#{vo.filePath},
			SYSDATE
		)
		</foreach>
		select * from dual
	</update>
```

ê¸°íšë‹¹ì‹œ  ëª¨ë“  ì²¨ë¶€íŒŒì¼  í…Œì´ë¸” êµ¬ì¡°ë¥¼ í†µì¼ì‹œì¼œì„œ ì´í›„ ì¿¼ë¦¬ë¬¸ì—ì„œ í…Œì´ë¸”ëª…ë§Œ ë”°ë¡œ ë°›ì•„ì˜¤ë©´ ë™ì¼í•œ sqlë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“  ë™ì ì¿¼ë¦¬

insert allì—ì„œ ì‹œí€€ìŠ¤ ë²ˆí˜¸ê°€ ì¦ê°€í•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì—¬ sql í•¨ìˆ˜ë¥¼ ì œì‘í•˜ì—¬ ì‚¬ìš©í•˜ì˜€ë‹¤.

```sql
create or replace function get_seq_no ( seq in varchar2 ) 
return number is num number;
begin
   execute immediate 
  'select ' || seq || '.nextval
         from dual'
         into num;
   return num;
end;
```